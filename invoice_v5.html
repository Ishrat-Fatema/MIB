<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIB | Enterprise Sales Navigator</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; --sidebar-width: 260px; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); overflow-x: hidden; }
        
        /* SIDEBAR */
        .sidebar { height: 100vh; width: var(--sidebar-width); position: fixed; top: 0; left: 0; background: linear-gradient(180deg, var(--primary) 0%, #1a252f 100%); color: white; padding-top: 25px; z-index: 1000; }
        .sidebar-brand { font-size: 22px; font-weight: 700; text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .sidebar-menu a { padding: 15px 25px; text-decoration: none; font-size: 15px; color: #bdc3c7; display: flex; align-items: center; border-left: 4px solid transparent; transition: 0.2s; }
        .sidebar-menu a:hover, .sidebar-menu a.active { background: rgba(255,255,255,0.1); color: white; border-left-color: var(--accent); }
        .license-info { position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 11px; color: #7f8c8d; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }

        /* MAIN */
        .main-content { margin-left: var(--sidebar-width); padding: 30px; }
        .card { border: none; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; background: white; }
        .stat-card { padding: 25px; border-radius: 10px; color: white; position: relative; overflow: hidden; }
        .bg-blue { background: linear-gradient(135deg, #3498db, #2980b9); }
        .bg-green { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .bg-orange { background: linear-gradient(135deg, #f39c12, #d35400); }
        .bg-purple { background: linear-gradient(135deg, #9b59b6, #8e44ad); }

        /* LICENSE SCREEN */
        #license-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.95); z-index: 9999; display: none; justify-content: center; align-items: center; color: white; backdrop-filter: blur(5px); }
        .license-box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); text-align: center; max-width: 450px; width: 90%; }
        .license-box input { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.3); color: white; text-align: center; font-family: monospace; font-size: 18px; letter-spacing: 2px; margin: 20px 0; display: block; width: 100%; padding: 10px; }

        /* PRINT STYLES */
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .sidebar, .main-content > div:not(.printable-area) { display: none !important; }
            .printable-area { display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            @page { size: A4; margin: 10mm; }
        }

        /* INVOICE TEMPLATE */
        .printable-area { display: none; font-family: 'Times New Roman', serif; color: #000; }
        .doc-container { border: 2px solid #000; min-height: 275mm; position: relative; }
        .doc-header { background: #eee; padding: 15px; border-bottom: 2px solid #000; display: flex; justify-content: space-between; align-items: center; }
        .doc-title { font-size: 24px; font-weight: bold; border: 2px solid #000; padding: 5px 15px; background: white; text-transform: uppercase; }
        .doc-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        .doc-table th { border: 1px solid #000; background: #ddd; padding: 6px; text-align: center; }
        .doc-table td { border: 1px solid #000; padding: 6px; }
        .doc-footer { position: absolute; bottom: 0; width: 100%; border-top: 1px solid #000; display: flex; font-size: 11px; }
    </style>
</head>
<body>

    <div id="license-overlay">
        <div class="license-box">
            <i class="fas fa-lock fa-3x mb-3 text-warning"></i>
            <h3>SYSTEM LOCKED</h3>
            <p>Enter License Key</p>
            <input type="text" id="licenseKeyInput" placeholder="KEY-XXXX-XXXX">
            <button class="btn btn-success w-100" onclick="system.activateLicense()">UNLOCK</button>
            <div id="contact-admin" style="display:none; color: #ff6b6b; margin-top: 15px; font-weight: bold;">License Expired. Contact Admin.</div>
        </div>
    </div>

    <div class="sidebar">
        <div class="sidebar-brand"><i class="fas fa-chart-network"></i> MIB Systems</div>
        <div class="sidebar-menu">
            <a href="#" onclick="router.navigate('dashboard')" id="nav-dashboard" class="active"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a>
            <a href="#" onclick="router.navigate('entry')" id="nav-entry"><i class="fas fa-plus-circle me-2"></i> New Transaction</a>
            <a href="#" onclick="router.navigate('records')" id="nav-records"><i class="fas fa-list me-2"></i> Records</a>
            <hr style="border-color: rgba(255,255,255,0.1);">
            <a href="#" onclick="system.backupData()" class="text-warning"><i class="fas fa-cloud-download-alt me-2"></i> Backup Data</a>
            <input type="file" id="restoreFile" style="display:none" onchange="system.restoreData(this)">
            <a href="#" onclick="document.getElementById('restoreFile').click()" class="text-info"><i class="fas fa-cloud-upload-alt me-2"></i> Restore Data</a>
        </div>
        <div class="license-info">v6.0 Gold | Valid: <span id="valid-until-display">...</span></div>
    </div>

    <div class="main-content">
        
        <div id="dashboard-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="m-0">Business Intelligence</h3>
                <button onclick="reports.generateAdvancedExcel()" class="btn btn-success shadow-sm">
                    <i class="fas fa-file-excel me-2"></i> Download Analytics Report
                </button>
            </div>

            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stat-card bg-blue">
                        <h6 class="text-uppercase opacity-75">Total Revenue</h6>
                        <h2>₹ <span id="kpi-revenue">0</span></h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-green">
                        <h6 class="text-uppercase opacity-75">Orders Processed</h6>
                        <h2 id="kpi-orders">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-orange">
                        <h6 class="text-uppercase opacity-75">Pending Amount</h6>
                        <h2>₹ <span id="kpi-pending">0</span></h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-purple">
                        <h6 class="text-uppercase opacity-75">Tax Collected</h6>
                        <h2>₹ <span id="kpi-tax">0</span></h2>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="card p-3 h-100">
                        <h6 class="card-title text-muted mb-3">Sales Trend (Revenue Analysis)</h6>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 mb-3">
                        <h6 class="card-title text-muted mb-3">Payment Status</h6>
                        <div style="height: 200px; display: flex; justify-content: center;">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="card p-3">
                        <h6 class="card-title text-muted mb-3">Top Clients</h6>
                        <canvas id="clientChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="entry-section" style="display: none;">
            <div class="d-flex justify-content-between mb-3">
                <h3>New Invoice / Challan</h3>
                <button class="btn btn-outline-primary btn-sm" onclick="entry.loadSample()">Load Sample</button>
            </div>
            <div class="card p-4">
                <form id="invoiceForm">
                    <div class="row mb-3">
                        <div class="col-md-3"><label class="small text-muted">PO Number</label><input type="text" id="poNo" class="form-control" required></div>
                        <div class="col-md-3"><label class="small text-muted">PO Date</label><input type="date" id="poDate" class="form-control" required></div>
                        <div class="col-md-3"><label class="small text-muted">Vehicle No</label><input type="text" id="vehicleNo" class="form-control" placeholder="MH-XX-XXXX"></div>
                        <div class="col-md-3"><label class="small text-muted">Invoice No</label><input type="text" id="invNo" class="form-control bg-light" readonly></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6"><label class="small text-muted">Client Name</label><input type="text" id="clientName" class="form-control" required></div>
                        <div class="col-md-6"><label class="small text-muted">Address</label><input type="text" id="clientAddr" class="form-control"></div>
                    </div>
                    <div class="mb-3"><label class="small text-muted">Item Description</label><textarea id="itemDesc" class="form-control" rows="2" required></textarea></div>
                    
                    <div class="row bg-light p-3 rounded mx-0 border">
                        <div class="col-md-2"><label class="small">HSN</label><input type="text" id="hsnCode" class="form-control" value="8536"></div>
                        <div class="col-md-2"><label class="small">Qty</label><input type="number" id="qty" class="form-control" oninput="entry.calc()"></div>
                        <div class="col-md-3"><label class="small">Rate</label><input type="number" id="rate" class="form-control" oninput="entry.calc()" step="0.01"></div>
                        <div class="col-md-2"><label class="small">GST %</label>
                            <select id="gstRate" class="form-select" onchange="entry.calc()">
                                <option value="18">18%</option><option value="12">12%</option><option value="5">5%</option><option value="28">28%</option>
                            </select>
                        </div>
                        <div class="col-md-3 text-end">
                            <label class="small d-block">Grand Total</label>
                            <h3 class="text-success m-0">₹ <span id="displayTotal">0.00</span></h3>
                            <small class="text-muted">Tax: ₹<span id="displayTax">0.00</span></small>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mt-3">
                        <button type="button" class="btn btn-primary px-5" onclick="entry.save()"><i class="fas fa-save me-2"></i> Save Record</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="records-section" style="display: none;">
            <h3>Transaction Records</h3>
            <div class="card p-0 overflow-hidden">
                <table class="table table-hover mb-0 align-middle" id="ordersTable">
                    <thead class="table-light small text-uppercase">
                        <tr><th>Date</th><th>Inv #</th><th>Client</th><th>Amount</th><th>Status</th><th class="text-end">Actions</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="print-container" class="printable-area"></div>

    <script>
        // --- CORE DATA STORE ---
        const DB_KEY = 'mib_enterprise_v6';
        const LIC_KEY = 'mib_lic_v6';
        let store = { orders: JSON.parse(localStorage.getItem(DB_KEY)) || [] };
        let charts = {};

        // --- 1. SYSTEM INIT ---
        const system = {
            init: () => {
                if(!system.checkLicense()) return;
                dashboard.render(); 
                historyTable.render(); 
                entry.reset();
            },
            checkLicense: () => {
                const key = localStorage.getItem(LIC_KEY);
                const overlay = document.getElementById('license-overlay');
                if(!key) { overlay.style.display='flex'; return false; }
                try {
                    const parts = atob(key).split('|');
                    if(parts.length !== 3 || parts[2] !== 'SECRET_SALT') throw new Error();
                    document.getElementById('valid-until-display').innerText = parts[1];
                    if(new Date() > new Date(parts[1])) {
                        overlay.style.display='flex'; 
                        document.getElementById('contact-admin').style.display='block';
                        return false;
                    }
                    overlay.style.display='none'; return true;
                } catch(e) { overlay.style.display='flex'; return false; }
            },
            activateLicense: () => {
                const k = document.getElementById('licenseKeyInput').value.trim();
                if(k) { localStorage.setItem(LIC_KEY, k); location.reload(); }
            },
            backupData: () => {
                const blob = new Blob([JSON.stringify(store.orders)], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `MIB_Backup_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
            },
            restoreData: (input) => {
                const file = input.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        store.orders = JSON.parse(e.target.result);
                        localStorage.setItem(DB_KEY, JSON.stringify(store.orders));
                        alert("Database Restored Successfully!");
                        location.reload();
                    } catch(err) { alert("Invalid Backup File"); }
                };
                reader.readAsText(file);
            }
        };

        // --- 2. ADVANCED EXCEL REPORTING ENGINE ---
        const reports = {
            generateAdvancedExcel: () => {
                const wb = XLSX.utils.book_new();

                // SHEET 1: MASTER DATA (Raw Log)
                const masterData = store.orders.map(o => ({
                    "Date": o.date,
                    "Time": new Date(o.id).toLocaleTimeString(),
                    "Invoice No": o.invNo,
                    "PO No": o.poNo,
                    "Client Name": o.client,
                    "GSTIN State": "Maharashtra (27)",
                    "Description": o.desc,
                    "HSN": o.hsn,
                    "Qty": o.qty,
                    "Rate": o.rate,
                    "Basic Value": o.basic,
                    "Tax Amount": o.tax,
                    "Total Amount": o.total,
                    "Payment Status": o.status
                }));
                const wsMaster = XLSX.utils.json_to_sheet(masterData);
                XLSX.utils.book_append_sheet(wb, wsMaster, "Master Data");

                // SHEET 2: MONTHLY ANALYSIS (Calculated Pivot)
                const monthlyStats = {};
                store.orders.forEach(o => {
                    const monthKey = o.date.substring(0, 7); // "2025-10"
                    if (!monthlyStats[monthKey]) monthlyStats[monthKey] = { revenue: 0, tax: 0, count: 0 };
                    monthlyStats[monthKey].revenue += o.total;
                    monthlyStats[monthKey].tax += o.tax;
                    monthlyStats[monthKey].count += 1;
                });

                const analysisData = Object.keys(monthlyStats).sort().map(m => ({
                    "Month": m,
                    "Total Orders": monthlyStats[m].count,
                    "Revenue (₹)": monthlyStats[m].revenue,
                    "Tax Collected (₹)": monthlyStats[m].tax,
                    "Avg Order Value": (monthlyStats[m].revenue / monthlyStats[m].count).toFixed(2)
                }));
                const wsAnalysis = XLSX.utils.json_to_sheet(analysisData);
                XLSX.utils.book_append_sheet(wb, wsAnalysis, "Monthly Analysis");

                // SHEET 3: CLIENT PERFORMANCE
                const clientStats = {};
                store.orders.forEach(o => {
                    if (!clientStats[o.client]) clientStats[o.client] = 0;
                    clientStats[o.client] += o.total;
                });
                const clientData = Object.keys(clientStats).map(c => ({
                    "Client Name": c,
                    "Total Spend (₹)": clientStats[c]
                })).sort((a,b) => b["Total Spend (₹)"] - a["Total Spend (₹)"]);
                
                const wsClients = XLSX.utils.json_to_sheet(clientData);
                XLSX.utils.book_append_sheet(wb, wsClients, "Top Clients");

                // DOWNLOAD
                XLSX.writeFile(wb, `MIB_Advanced_Report_${new Date().toISOString().slice(0,10)}.xlsx`);
            }
        };

        // --- 3. DASHBOARD VISUALIZATION ---
        const dashboard = {
            render: () => {
                // KPIs
                const totalRev = store.orders.reduce((s, o) => s + o.total, 0);
                const totalTax = store.orders.reduce((s, o) => s + o.tax, 0);
                const pending = store.orders.filter(o => o.status === 'Unpaid').reduce((s, o) => s + o.total, 0);
                
                document.getElementById('kpi-revenue').innerText = totalRev.toLocaleString('en-IN', {maximumFractionDigits:0});
                document.getElementById('kpi-orders').innerText = store.orders.length;
                document.getElementById('kpi-pending').innerText = pending.toLocaleString('en-IN', {maximumFractionDigits:0});
                document.getElementById('kpi-tax').innerText = totalTax.toLocaleString('en-IN', {maximumFractionDigits:0});

                // GRAPH 1: Sales Trend (Monthly)
                const monthData = {};
                store.orders.forEach(o => {
                    const m = o.date.substring(0, 7);
                    monthData[m] = (monthData[m] || 0) + o.total;
                });
                const sortedMonths = Object.keys(monthData).sort();
                
                if(charts.sales) charts.sales.destroy();
                charts.sales = new Chart(document.getElementById('salesChart'), {
                    type: 'line',
                    data: {
                        labels: sortedMonths,
                        datasets: [{
                            label: 'Revenue',
                            data: sortedMonths.map(m => monthData[m]),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });

                // GRAPH 2: Payment Status (Pie)
                const paid = store.orders.filter(o => o.status === 'Paid').length;
                const unpaid = store.orders.filter(o => o.status === 'Unpaid').length;
                
                if(charts.status) charts.status.destroy();
                charts.status = new Chart(document.getElementById('statusChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Paid', 'Unpaid'],
                        datasets: [{ data: [paid, unpaid], backgroundColor: ['#2ecc71', '#e74c3c'] }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });

                // GRAPH 3: Top 5 Clients
                const clientMap = {};
                store.orders.forEach(o => clientMap[o.client] = (clientMap[o.client] || 0) + o.total);
                const topClients = Object.entries(clientMap).sort((a,b) => b[1] - a[1]).slice(0, 5);

                if(charts.clients) charts.clients.destroy();
                charts.clients = new Chart(document.getElementById('clientChart'), {
                    type: 'bar',
                    data: {
                        labels: topClients.map(c => c[0].substring(0, 10) + '...'),
                        datasets: [{
                            label: 'Sales',
                            data: topClients.map(c => c[1]),
                            backgroundColor: '#9b59b6',
                            borderRadius: 4
                        }]
                    },
                    options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }
                });
            }
        };

        // --- 4. ENTRY & LOGIC ---
        const entry = {
            reset: () => {
                document.getElementById('invoiceForm').reset();
                const next = store.orders.length + 1;
                document.getElementById('invNo').value = `INV-${new Date().getFullYear()}-${String(next).padStart(3,'0')}`;
                document.getElementById('poDate').valueAsDate = new Date();
                entry.calc();
            },
            calc: () => {
                const q = parseFloat(document.getElementById('qty').value)||0;
                const r = parseFloat(document.getElementById('rate').value)||0;
                const g = parseFloat(document.getElementById('gstRate').value)||0;
                const b = q*r; 
                const t = b*(g/100);
                document.getElementById('displayTotal').innerText = (b+t).toLocaleString('en-IN', {minimumFractionDigits:2});
                document.getElementById('displayTax').innerText = t.toFixed(2);
                return { basic: b, tax: t, total: b+t };
            },
            loadSample: () => {
                document.getElementById('poNo').value = "52256261101789";
                document.getElementById('clientName').value = "SSE/TL/PL, Western Railway";
                document.getElementById('itemDesc').value = "Aluminium type Junction Connector/Cable Jointer (PL: 468101800017)";
                document.getElementById('qty').value = 150;
                document.getElementById('rate').value = 2718;
                entry.calc();
            },
            save: () => {
                if(!document.getElementById('invoiceForm').checkValidity()) { alert("Please fill all required fields"); return; }
                const c = entry.calc();
                const o = {
                    id: Date.now(),
                    invNo: document.getElementById('invNo').value,
                    poNo: document.getElementById('poNo').value,
                    poDate: document.getElementById('poDate').value,
                    vehicleNo: document.getElementById('vehicleNo').value,
                    client: document.getElementById('clientName').value,
                    addr: document.getElementById('clientAddr').value || '',
                    desc: document.getElementById('itemDesc').value,
                    hsn: document.getElementById('hsnCode').value,
                    qty: document.getElementById('qty').value,
                    rate: document.getElementById('rate').value,
                    gst: document.getElementById('gstRate').value,
                    basic: c.basic, tax: c.tax, total: c.total,
                    status: 'Unpaid',
                    date: new Date().toISOString().split('T')[0]
                };
                store.orders.push(o);
                localStorage.setItem(DB_KEY, JSON.stringify(store.orders));
                alert("Saved!");
                router.navigate('records');
            }
        };

        // --- 5. UI ROUTER ---
        const router = {
            navigate: (id) => {
                ['dashboard','entry','records'].forEach(x => {
                    document.getElementById(x+'-section').style.display='none';
                    document.getElementById('nav-'+x).classList.remove('active');
                });
                document.getElementById(id+'-section').style.display='block';
                document.getElementById('nav-'+id).classList.add('active');
                if(id === 'dashboard') dashboard.render();
                if(id === 'records') historyTable.render();
                if(id === 'entry') entry.reset();
            }
        };

        // --- 6. RECORDS TABLE & PRINT ---
        const historyTable = {
            render: () => {
                const tb = document.querySelector('#ordersTable tbody'); tb.innerHTML='';
                [...store.orders].reverse().forEach(o => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${o.date}</td>
                        <td class="fw-bold text-dark">${o.invNo}</td>
                        <td>${o.client}</td>
                        <td class="fw-bold text-success">₹${o.total.toFixed(2)}</td>
                        <td><span class="badge bg-${o.status==='Paid'?'success':'danger'}">${o.status}</span></td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-success me-1" onclick="toggleStatus(${o.id})" title="Toggle Paid">$</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="printer.print(${o.id},'inv')"><i class="fas fa-file-invoice"></i></button>
                            <button class="btn btn-sm btn-outline-dark" onclick="printer.print(${o.id},'dc')"><i class="fas fa-truck"></i></button>
                        </td>`;
                    tb.appendChild(tr);
                });
            }
        };

        function toggleStatus(id) {
            const o = store.orders.find(x => x.id === id);
            o.status = o.status === 'Paid' ? 'Unpaid' : 'Paid';
            localStorage.setItem(DB_KEY, JSON.stringify(store.orders));
            historyTable.render();
        }

        const printer = {
            numToWords: (n) => n.toFixed(0) + " Rupees Only", // Placeholder
            print: (id, type) => {
                const o = store.orders.find(x => x.id === id);
                const isInv = type === 'inv';
                const title = isInv ? "TAX INVOICE" : "DELIVERY CHALLAN";
                
                // Tax Columns Logic
                let taxHead = '', taxBody = '';
                if(isInv) {
                    taxHead = `<th width="8%">CGST %</th><th width="10%">CGST Amt</th><th width="8%">SGST %</th><th width="10%">SGST Amt</th>`;
                    taxBody = `<td align="center">${o.gst/2}%</td><td align="right">${(o.tax/2).toFixed(2)}</td><td align="center">${o.gst/2}%</td><td align="right">${(o.tax/2).toFixed(2)}</td>`;
                }

                const html = `
                <div class="doc-container">
                    <div class="doc-header">
                        <div>
                            <h2 style="margin:0">MIB</h2>
                            <p style="margin:0; font-size:12px">Plot 74 N-13, CIDCO, Aurangabad - 431001<br>GSTIN: 27ABCDE1234F1Z5 | Mob: 7620858731</p>
                        </div>
                        <div class="text-end">
                            <div class="doc-title">${title}</div>
                            <small>Original for Recipient</small>
                        </div>
                    </div>
                    <div style="display:flex; border-bottom:1px solid #000;">
                        <div style="width:50%; padding:10px; border-right:1px solid #000">
                            <strong>Billed To:</strong><br>
                            <b>${o.client}</b><br>${o.addr}<br>
                            ${o.vehicleNo ? '<b>Vehicle No:</b> '+o.vehicleNo : ''}
                        </div>
                        <div style="width:50%; padding:10px;">
                            <table width="100%">
                                <tr><td><strong>Inv No:</strong> ${o.invNo}</td><td><strong>Date:</strong> ${o.date}</td></tr>
                                <tr><td><strong>PO No:</strong> ${o.poNo}</td><td><strong>PO Date:</strong> ${o.poDate}</td></tr>
                            </table>
                        </div>
                    </div>
                    <div style="min-height:450px;">
                        <table class="doc-table">
                            <thead>
                                <tr>
                                    <th width="5%">#</th>
                                    <th>Description</th>
                                    <th width="8%">HSN</th>
                                    <th width="8%">Qty</th>
                                    ${isInv ? `<th width="10%">Rate</th><th width="12%">Amount</th>${taxHead}` : ''}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td align="center">1</td>
                                    <td><b>${o.desc}</b></td>
                                    <td align="center">${o.hsn}</td>
                                    <td align="center"><b>${o.qty}</b></td>
                                    ${isInv ? `<td align="right">${o.rate}</td><td align="right">${o.basic.toFixed(2)}</td>${taxBody}` : ''}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="doc-footer">
                        <div style="width:60%; border-right:1px solid #000; padding:10px;">
                            <strong>Terms & Conditions:</strong>
                            <ol style="margin:5px; padding-left:15px;">
                                <li>Subject to Aurangabad Jurisdiction.</li>
                                <li>Interest @24% on delayed payments.</li>
                            </ol>
                            ${isInv ? `
                            <div style="border:1px dashed #000; background:#f9f9f9; padding:5px; margin-top:10px;">
                                <b>Bank:</b> CHIKHLI URBAN CO-OP BANK LTD<br>
                                <b>A/c:</b> 025011100000132 | <b>IFSC:</b> YESB0CCUB25
                            </div>
                            <div style="margin-top:10px; font-weight:bold;">Amount: ${printer.numToWords(o.total)}</div>
                            <div style="margin-top:5px; font-size:10px;"><i>We declare that this invoice shows the actual price of the goods described.</i></div>
                            ` : `<div style="margin-top:50px; border:1px solid #000; width:150px; height:50px; text-align:center; padding-top:15px;">Receiver's Stamp</div>`}
                        </div>
                        <div style="width:40%; display:flex; flex-direction:column;">
                            ${isInv ? `
                            <div style="display:flex; justify-content:space-between; padding:5px 10px; border-bottom:1px solid #ccc;"><span>Taxable:</span><span>${o.basic.toFixed(2)}</span></div>
                            <div style="display:flex; justify-content:space-between; padding:5px 10px; border-bottom:1px solid #ccc;"><span>CGST:</span><span>${(o.tax/2).toFixed(2)}</span></div>
                            <div style="display:flex; justify-content:space-between; padding:5px 10px; border-bottom:1px solid #ccc;"><span>SGST:</span><span>${(o.tax/2).toFixed(2)}</span></div>
                            <div style="display:flex; justify-content:space-between; padding:10px; background:#ddd; font-weight:bold; border-top:2px solid #000;"><span>TOTAL</span><span>₹${o.total.toFixed(2)}</span></div>
                            ` : ''}
                            <div style="margin-top:auto; text-align:center; padding:20px;">
                                <b>For MIB</b><br><br><br><span style="border-top:1px solid #000;">Authorized Signatory</span>
                            </div>
                        </div>
                    </div>
                </div>`;
                document.getElementById('print-container').innerHTML = html;
                window.print();
            }
        };

        window.onload = system.init;
    </script>
</body>
</html>